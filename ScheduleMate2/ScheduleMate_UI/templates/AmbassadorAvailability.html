<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ambassador Availability | ScheduleMate</title>
    <link rel="stylesheet" href="../static/styles.css">  <!-- Corrected path -->
    <script defer src="../static/scripts.js"></script>
</head>

<body>
    <header>
        <div class="logo">
            <img src="../static/assets/schedulemate-logo.png" alt="ScheduleMate Logo">
            <p>ScheduleMate</p>
        </div>
        <nav class="top-nav">
            <a href="../templates/dashboard.html">Dashboard</a>
            <a href="../templates/manage-tours.html">Manage Tours</a>
            <a href="../templates/AmbassadorAvailability.html">Ambassador Availability</a>
            <a href="../templates/reports.html">Reports</a>
            <a href="../templates/notifications.html">Notifications</a>
            <button class="sign-in-btn">
                <a href="signin.html" style="color: white; text-decoration: none;">Sign in</a>
            </button>
            <button class="register-btn">Register</button>
        </nav>
    </header>

    <main class="container">
        <section class="dashboard-content">
            <div class="quick-action-menu">
                <div class="toggle-wrapper ">
                    <div class="checkbox-wrapper-20">
                        <div class="switch">
                            <input id="edit-availability" class="input" type="checkbox">
                            <label for="edit-availability" class="slider"></label>
                        </div>
                    </div>
                    <span>Edit Availability</span>
                </div>
                <h1>Ambassador Availability</h1>
            </div>
            <!--<h1>Ambassador Availability</h1> -->
            <div class="availability-grid">
                <!-- Content dynamically generated by JavaScript -->
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-container">
            <div class="footer-info">
                <p>Â© 2024 ScheduleMate. All rights reserved.</p>
            </div>
            <div class="footer-links">
                <a href="#">Contact Us</a>
                <a href="#">Privacy Policy</a>
                <a href="#">Terms of Service</a>
            </div>
            <div class="footer-socials">
                <a href="#">Twitter</a>
                <a href="#">LinkedIn</a>
                <a href="#">Facebook</a>
            </div>
        </div>
    </footer>

    <script>
        function convertTo12HourFormat(time) {
            const [hours, minutes] = time.split(':').map(Number); // Split the time into hours and minutes
            const suffix = hours >= 12 ? 'PM' : 'AM'; // Determine AM or PM
            const formattedHours = hours % 12 || 12; // Convert hours to 12-hour format
            const formattedMinutes = minutes < 10 ? `0${minutes}` : minutes; // Add leading zero for minutes if needed
            return `${formattedHours}:${formattedMinutes} ${suffix}`;
        }

        document.addEventListener("DOMContentLoaded", function () {
            // Fetch availability data from the PHP endpoint
            fetch("../utils/availability.php") // Path to your PHP file
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Failed to fetch availability data.");
                    }
                    return response.json();
                })
                .then(data => {
                    // Populate availability container
                    const container = document.querySelector(".availability-grid");

                    // Clear any placeholder content
                    container.innerHTML = "";

                    if (data.length === 0) {
                        container.innerHTML = "<p>No availability data found.</p>";
                        return;
                    }

                    // Group data by ambassador and display it
                    data.forEach(ambassador => {
                        const ambassadorBlock = document.createElement("div");
                        ambassadorBlock.classList.add("ambassador-block");

                        const name = document.createElement("h2");
                        name.textContent = ambassador.ambassador_name;
                        ambassadorBlock.appendChild(name);

                        const availabilityList = document.createElement("ul");
                        ambassador.availability.forEach(slot => {
                            const listItem = document.createElement("li");
                            
                            // Convert military time to AM/PM format
                            const startTime = convertTo12HourFormat(slot.start_time);
                            const endTime = convertTo12HourFormat(slot.end_time);
                            
                            listItem.textContent = `${slot.weekday}: ${startTime} - ${endTime}`;
                            availabilityList.appendChild(listItem);
                        });

                        ambassadorBlock.appendChild(availabilityList);
                        container.appendChild(ambassadorBlock);
                    });
                })
                .catch(error => {
                    console.error(error);
                    const container = document.querySelector(".availability-grid");
                    container.innerHTML = "<p>Error loading availability data.</p>";
                });
        });
    </script>
</body>
</html>
